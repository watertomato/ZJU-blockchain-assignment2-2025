# 去中心化彩票系统 - 前端界面设计方案

## 项目概述

基于作业要求，设计一个进阶的去中心化彩票系统前端界面，支持竞猜玩家和公证人两种角色，实现彩票购买、交易和结算等核心功能。

## 用户角色分析

### 1. 公证人 (Notary)
- **权限**: 创建竞猜项目、设置奖池、输入结果、管理项目
- **主要操作**: 项目管理、结果公布、资金管理

### 2. 竞猜玩家 (Player)  
- **权限**: 购买彩票、交易彩票、查看项目、领取奖励
- **主要操作**: 浏览项目、购买彩票、彩票交易、查看收益

## 核心功能模块设计

### 1. 登录与身份识别系统

#### 1.1 智能登录页面
```
┌─────────────────────────────────────────────────────────────┐
│                    🎲 EasyBet                               │
│                去中心化彩票系统                              │
│                                                           │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              欢迎使用 EasyBet                        │   │
│  │                                                   │   │
│  │  🔗 请连接您的钱包以开始使用                         │   │
│  │                                                   │   │
│  │  ┌─────────────────────────────────────────────┐   │   │
│  │  │ [🦊 MetaMask] [🔗 WalletConnect] [💰 Coinbase] │   │
│  │  └─────────────────────────────────────────────┘   │   │
│  │                                                   │   │
│  │  💡 系统将自动识别您的身份权限                      │   │
│  │  • 持有公证人NFT → 自动获得管理权限                 │   │
│  │  • 普通地址 → 竞猜玩家权限                         │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

#### 1.2 智能身份识别流程
```
┌─────────────────────────────────────────────────────────────┐
│ 🔐 智能身份识别                                              │
│                                                           │
│ 步骤1: 连接钱包                                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🔗 正在连接钱包...                                      │ │
│ │ 检测到钱包地址: 0x1234...5678                           │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                           │
│ 步骤2: 自动权限检测                                        │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🔍 正在检测用户权限...                                  │ │
│ │                                                       │ │
│ │ ✅ 检测到公证人NFT (Token ID: #001)                     │ │
│ │ ✅ NFT验证通过                                          │ │
│ │ ✅ 最低余额验证通过 (15.5 ETH ≥ 10 ETH)                │ │
│ │                                                       │ │
│ │ 🎉 欢迎回来，公证人！                                   │ │
│ │ [进入管理面板]                                          │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                           │
│ 或者 (普通用户)                                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 🔍 正在检测用户权限...                                  │ │
│ │                                                       │ │
│ │ ❌ 未检测到公证人NFT                                    │ │
│ │ ✅ 识别为竞猜玩家                                       │ │
│ │                                                       │ │
│ │ 🎯 欢迎来到 EasyBet！                                  │ │
│ │ [开始竞猜]                                              │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 1.3 NFT权限验证机制 (推荐方案)

**智能合约设计**
```solidity
// 公证人NFT合约
contract NotaryNFT is ERC721 {
    mapping(uint256 => bool) public activeTokens;  // 激活的NFT
    uint256 public totalSupply;
    
    function mint(address to) external onlyOwner {
        uint256 tokenId = totalSupply++;
        _mint(to, tokenId);
        activeTokens[tokenId] = true;
    }
    
    function deactivateToken(uint256 tokenId) external onlyOwner {
        activeTokens[tokenId] = false;
    }
}

// 主合约权限验证
contract EasyBet {
    NotaryNFT public notaryNFT;
    uint256 public constant MIN_ETH_BALANCE = 10 ether;
    
    modifier onlyNotary() {
        require(isNotary(msg.sender), "Not authorized notary");
        _;
    }
    
    function isNotary(address user) public view returns (bool) {
        // 检查是否持有激活的公证人NFT
        uint256 balance = notaryNFT.balanceOf(user);
        if (balance == 0) return false;
        
        // 检查至少有一个激活的NFT
        for (uint256 i = 0; i < balance; i++) {
            uint256 tokenId = notaryNFT.tokenOfOwnerByIndex(user, i);
            if (notaryNFT.activeTokens(tokenId)) {
                // 检查最低ETH余额
                return user.balance >= MIN_ETH_BALANCE;
            }
        }
        return false;
    }
}
```

**前端自动检测逻辑**
```typescript
// 自动身份检测函数
async function detectUserRole(walletAddress: string): Promise<'notary' | 'player'> {
    try {
        // 1. 检查是否持有公证人NFT
        const notaryNFTContract = new ethers.Contract(NOTARY_NFT_ADDRESS, NotaryNFT_ABI, provider);
        const nftBalance = await notaryNFTContract.balanceOf(walletAddress);
        
        if (nftBalance.gt(0)) {
            // 2. 检查是否有激活的NFT
            for (let i = 0; i < nftBalance.toNumber(); i++) {
                const tokenId = await notaryNFTContract.tokenOfOwnerByIndex(walletAddress, i);
                const isActive = await notaryNFTContract.activeTokens(tokenId);
                
                if (isActive) {
                    // 3. 检查ETH余额
                    const ethBalance = await provider.getBalance(walletAddress);
                    if (ethBalance.gte(ethers.utils.parseEther("10"))) {
                        return 'notary';
                    }
                }
            }
        }
        
        return 'player';
    } catch (error) {
        console.error('Role detection failed:', error);
        return 'player'; // 默认为玩家
    }
}
```

**优势分析**
- ✅ **用户体验优化**：无需手动选择，系统自动识别
- ✅ **安全性保障**：基于区块链NFT的不可伪造权限
- ✅ **灵活管理**：可以激活/停用特定NFT，实现权限管理
- ✅ **防止滥用**：最低ETH余额要求防止恶意行为
- ✅ **去中心化**：不依赖中心化的白名单管理

### 2. 钱包连接与状态管理

#### 2.1 钱包连接组件
```
┌─────────────────────────────────────┐
│  🔗 连接钱包                          │
│  ┌─────────────────────────────────┐ │
│  │ [MetaMask] [WalletConnect]      │ │
│  │ [Coinbase Wallet]              │ │
│  └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

#### 2.2 用户状态管理
```
┌─────────────────────────────────────┐
│ 👤 用户信息                          │
│ 地址: 0x1234...5678                 │
│ 身份: 🎯 竞猜玩家 / ⚖️ 公证人         │
│ ETH余额: 10.5 ETH                   │
│ 积分余额: 1,250 PTS (Bonus功能)     │
│ NFT权限: ✅ 公证人证书 #001 (如适用)  │
│ [刷新状态] [领取测试ETH]             │
└─────────────────────────────────────┘
```

**状态管理逻辑**
```typescript
interface UserState {
    address: string;
    role: 'notary' | 'player';
    ethBalance: BigNumber;
    erc20Balance: BigNumber;
    notaryNFTs: Array<{
        tokenId: number;
        isActive: boolean;
    }>;
    isConnected: boolean;
}

// 实时监听用户状态变化
const useUserState = () => {
    const [userState, setUserState] = useState<UserState>();
    
    useEffect(() => {
        // 监听钱包连接状态
        // 监听余额变化
        // 监听NFT转移事件
        // 自动更新用户角色
    }, []);
    
    return userState;
};
```

### 3. 主导航界面

#### 3.1 导航栏设计
```
┌─────────────────────────────────────────────────────────────┐
│ 🎲 EasyBet 去中心化彩票系统                                   │
│ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐     ┌──────────┐ │
│ │首页 │ │项目 │ │交易 │ │我的 │ │管理 │     │ 钱包信息  │ │
│ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘     └──────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 4. 竞猜项目展示

#### 4.1 项目列表页面
```
┌─────────────────────────────────────────────────────────────┐
│ 🏆 竞猜项目                                                  │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│ │ 🏀 NBA MVP   │ │ 🏎️ F1冠军    │ │ 🎤 好声音    │           │
│ │ 奖池: 50 ETH │ │ 奖池: 30 ETH │ │ 奖池: 20 ETH │           │
│ │ 截止: 7天    │ │ 截止: 15天   │ │ 截止: 3天    │           │
│ │ 参与: 156人  │ │ 参与: 89人   │ │ 参与: 234人  │           │
│ │ [查看详情]   │ │ [查看详情]   │ │ [查看详情]   │           │
│ └─────────────┘ └─────────────┘ └─────────────┘           │
│                                                           │
│ 筛选: [进行中] [已结束] [我参与的]                          │
└─────────────────────────────────────────────────────────────┘
```

#### 4.2 项目详情页面
```
┌─────────────────────────────────────────────────────────────┐
│ 🏀 2024-25 NBA常规赛MVP竞猜                                  │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 项目信息                                                 │ │
│ │ • 奖池总额: 50.5 ETH                                    │ │
│ │ • 截止时间: 2025-04-15 23:59:59                        │ │
│ │ │ • 参与人数: 156人                                      │ │
│ │ • 项目状态: 进行中                                      │ │
│ │ • 公证人: 0xabcd...1234                                │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                           │
│ 竞猜选项:                                                  │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│ │ 🏀 詹姆斯    │ │ 🏀 库里      │ │ 🏀 杜兰特    │           │
│ │ 赔率: 1:2.5  │ │ 赔率: 1:3.2  │ │ 赔率: 1:4.1  │           │
│ │ 投注: 20 ETH │ │ 投注: 15 ETH │ │ 投注: 12 ETH │           │
│ │ 彩票: 45张   │ │ 彩票: 32张   │ │ 彩票: 28张   │           │
│ │ [购买彩票]   │ │ [购买彩票]   │ │ [购买彩票]   │           │
│ └─────────────┘ └─────────────┘ └─────────────┘           │
└─────────────────────────────────────────────────────────────┘
```

### 5. 彩票购买流程

#### 5.1 购买彩票弹窗
```
┌─────────────────────────────────────┐
│ 🎫 购买彩票                          │
│ ┌─────────────────────────────────┐ │
│ │ 选择选项: 詹姆斯 (赔率 1:2.5)    │ │
│ │ 购买金额: [____] ETH            │ │
│ │ 预计获得: 1 张彩票凭证           │ │
│ │ 潜在收益: 2.5 ETH               │ │
│ │                                │ │
│ │ 支付方式:                       │ │
│ │ ○ ETH直接支付                   │ │
│ │ ○ ERC20积分支付 (Bonus)         │ │
│ │                                │ │
│ │ [确认购买] [取消]               │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 6. 彩票交易市场

#### 6.1 交易市场主页
```
┌─────────────────────────────────────────────────────────────┐
│ 💱 彩票交易市场                                              │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 搜索: [项目名称/选项] [筛选: 价格▼] [我的挂单]           │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                           │
│ 在售彩票:                                                  │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 项目        │ 选项    │ 原价  │ 售价  │ 卖家     │ 操作 │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ NBA MVP     │ 詹姆斯  │ 1 ETH │ 1.2ETH│ 0x12..34│ [购买]│ │
│ │ F1冠军      │ 汉密尔顿│ 2 ETH │ 1.8ETH│ 0x56..78│ [购买]│ │
│ │ 好声音冠军   │ 选手A   │ 0.5ETH│ 0.7ETH│ 0x9a..bc│ [购买]│ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 6.2 订单簿界面 (Bonus功能)
```
┌─────────────────────────────────────────────────────────────┐
│ 📊 NBA MVP - 詹姆斯 订单簿                                   │
│ ┌─────────────────────┐ ┌─────────────────────┐           │
│ │ 🔴 卖单 (Ask)        │ │ 🟢 买单 (Bid)        │           │
│ │ 价格    │ 数量 │ 总计│ │ 价格    │ 数量 │ 总计│           │
│ │ 1.25ETH │ 3张  │3.75│ │ 1.15ETH │ 5张  │5.75│           │
│ │ 1.22ETH │ 2张  │2.44│ │ 1.12ETH │ 2张  │2.24│           │
│ │ 1.20ETH │ 1张  │1.20│ │ 1.10ETH │ 4张  │4.40│           │
│ └─────────────────────┘ └─────────────────────┘           │
│                                                           │
│ 交易操作:                                                  │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [市价买入] [限价买入] [市价卖出] [限价卖出]              │ │
│ │ 价格: [____] ETH  数量: [____] 张                       │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 6. 个人中心

#### 6.1 我的彩票
```
┌─────────────────────────────────────────────────────────────┐
│ 🎫 我的彩票                                                  │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 项目        │ 选项   │ 购买价格│ 当前价值│ 状态    │ 操作 │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ NBA MVP     │ 詹姆斯 │ 1.0 ETH │ 1.2 ETH │ 进行中  │[出售]│ │
│ │ F1冠军      │ 维斯塔 │ 2.0 ETH │ 0.8 ETH │ 进行中  │[出售]│ │
│ │ 好声音冠军   │ 选手B  │ 0.5 ETH │ 已中奖  │ 可领取  │[领取]│ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                           │
│ 统计信息:                                                  │
│ • 总投入: 3.5 ETH                                          │
│ • 当前价值: 2.0 ETH                                        │
│ • 待领取奖励: 1.25 ETH                                     │
│ • 盈亏: -0.25 ETH                                         │
└─────────────────────────────────────────────────────────────┘
```

#### 6.2 交易历史
```
┌─────────────────────────────────────────────────────────────┐
│ 📈 交易历史                                                  │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 时间        │ 类型 │ 项目    │ 选项   │ 金额    │ 状态   │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ 2025-01-15  │ 购买 │ NBA MVP │ 詹姆斯 │ 1.0 ETH │ 成功   │ │
│ │ 2025-01-14  │ 出售 │ F1冠军  │ 汉密尔顿│ 1.8 ETH │ 成功   │ │
│ │ 2025-01-13  │ 购买 │ 好声音  │ 选手A  │ 0.5 ETH │ 成功   │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 7. 公证人管理界面

#### 7.1 项目管理面板
```
┌─────────────────────────────────────────────────────────────┐
│ ⚖️ 公证人管理面板                                            │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [+ 创建新项目]                    [批量操作] [导出数据]  │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                           │
│ 我的项目:                                                  │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 项目名      │ 状态   │ 奖池    │ 参与人数│ 截止时间│ 操作 │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ NBA MVP     │ 进行中 │ 50 ETH  │ 156人   │ 7天后   │[管理]│ │
│ │ F1冠军      │ 进行中 │ 30 ETH  │ 89人    │ 15天后  │[管理]│ │
│ │ 世界杯冠军   │ 已结束 │ 100 ETH │ 500人   │ 已结束  │[查看]│ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 7.2 创建项目界面
```
┌─────────────────────────────────────────────────────────────┐
│ ➕ 创建竞猜项目                                              │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 基本信息:                                               │ │
│ │ 项目名称: [________________________]                   │ │
│ │ 项目描述: [________________________]                   │ │
│ │ 截止时间: [2025-04-15] [23:59:59]                      │ │
│ │ 奖池金额: [____] ETH                                   │ │
│ │                                                       │ │
│ │ 竞猜选项: (至少2个)                                     │ │
│ │ 选项1: [詹姆斯] 初始赔率: [1:2.5]                       │ │
│ │ 选项2: [库里]   初始赔率: [1:3.2]                       │ │
│ │ 选项3: [杜兰特] 初始赔率: [1:4.1]                       │ │
│ │ [+ 添加选项]                                           │ │
│ │                                                       │ │
│ │ [预览项目] [创建项目] [取消]                            │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 7.3 结果输入界面
```
┌─────────────────────────────────────────────────────────────┐
│ 🏆 输入竞猜结果 - NBA MVP                                    │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 项目信息:                                               │ │
│ │ • 项目名称: 2024-25 NBA常规赛MVP竞猜                    │ │
│ │ • 奖池总额: 50.5 ETH                                   │ │
│ │ • 参与人数: 156人                                      │ │
│ │ • 截止时间: 2025-04-15 (已截止)                        │ │
│ │                                                       │ │
│ │ 选择获胜选项:                                           │ │
│ │ ○ 詹姆斯 (45张彩票)                                    │ │
│ │ ● 库里   (32张彩票) ← 选中                             │ │
│ │ ○ 杜兰特 (28张彩票)                                    │ │
│ │                                                       │ │
│ │ 结算预览:                                               │ │
│ │ • 获胜彩票数: 32张                                     │ │
│ │ • 单张奖励: 1.578 ETH                                  │ │
│ │ • 总奖励: 50.5 ETH                                     │ │
│ │                                                       │ │
│ │ [确认结算] [取消]                                       │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 8. Bonus功能界面

#### 8.1 ERC20积分系统
```
┌─────────────────────────────────────────────────────────────┐
│ 🪙 积分系统 (ERC20)                                          │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 我的积分: 1,250 PTS                                     │ │
│ │ 兑换比例: 1 ETH = 1000 PTS                              │ │
│ │                                                       │ │
│ │ 快速操作:                                               │ │
│ │ [领取每日积分] [ETH兑换积分] [积分兑换ETH]               │ │
│ │                                                       │ │
│ │ 积分用途:                                               │ │
│ │ • 购买彩票 (享受5%折扣)                                 │ │
│ │ • 支付交易手续费                                        │ │
│ │ • 参与积分专属竞猜                                      │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                           │
│ 积分历史:                                                  │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 时间        │ 类型     │ 数量    │ 余额      │ 说明     │ │
│ ├─────────────────────────────────────────────────────────┤ │
│ │ 2025-01-15  │ 获得     │ +100    │ 1,250     │ 每日签到 │ │
│ │ 2025-01-14  │ 消费     │ -500    │ 1,150     │ 购买彩票 │ │
│ │ 2025-01-13  │ 兑换     │ +1000   │ 1,650     │ ETH兑换  │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 响应式设计考虑

### 移动端适配
- 采用响应式布局，支持手机、平板、桌面端
- 重要操作按钮加大，便于触摸操作
- 简化移动端界面，突出核心功能

### 交互体验优化
- 加载状态提示
- 交易确认弹窗
- 错误处理和友好提示
- 实时数据更新

## 技术实现建议

### 前端技术栈
- **框架**: React 18+ with TypeScript
- **状态管理**: Redux Toolkit / Zustand
- **UI组件**: Ant Design / Material-UI
- **Web3集成**: ethers.js / web3.js
- **钱包连接**: WalletConnect / MetaMask SDK

### 关键组件设计
1. **WalletProvider**: 钱包连接和状态管理
2. **ContractProvider**: 智能合约交互封装
3. **ProjectCard**: 项目展示组件
4. **TicketCard**: 彩票展示组件
5. **OrderBook**: 订单簿组件
6. **TransactionModal**: 交易确认弹窗

### 数据流设计
```
用户操作 → 前端验证 → 钱包签名 → 智能合约 → 事件监听 → 界面更新
```

## 安全性考虑

1. **输入验证**: 所有用户输入进行前端验证
2. **交易确认**: 重要操作需要二次确认
3. **权限控制**: 根据用户角色显示不同界面
4. **错误处理**: 完善的错误捕获和用户提示

## 总结

本设计方案涵盖了去中心化彩票系统的完整用户界面，包括：
- 双角色用户体验 (公证人/玩家)
- 完整的彩票生命周期 (创建→购买→交易→结算)
- Bonus功能支持 (ERC20积分、订单簿)
- 响应式设计和良好的用户体验

界面设计注重功能性和易用性，为用户提供直观、高效的操作体验，同时保证系统的安全性和可靠性。