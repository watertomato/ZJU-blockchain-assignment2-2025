# NotaryNFT 公证人功能测试指南

## 📋 测试概述

本指南将逐步教您如何测试NotaryNFT公证人功能，包括：
- 部署智能合约
- 配置测试环境
- 验证公证人身份
- 测试公证人权限功能

## 🛠️ 环境准备

### 1. 系统要求
- Node.js (v16+)
- npm 或 yarn
- MetaMask 浏览器插件

### 2. 项目依赖
确保已安装所有依赖：
```bash
# 安装合约依赖
cd contracts
npm install

# 安装前端依赖
cd ../frontend
npm install
```

## 🚀 第一步：启动本地区块链网络

1. 打开终端，进入合约目录：
```bash
cd contracts
```

2. 启动Hardhat本地网络：
```bash
npx hardhat node
```

3. 保持此终端运行，您会看到：
   - 10个测试账户及其私钥
   - 每个账户有10000 ETH余额
   - 网络运行在 http://127.0.0.1:8545

**重要提示**：记录第一个账户的私钥，这将是部署者账户（公证人账户）

## 🔧 第二步：部署智能合约

1. 打开新终端，进入合约目录：
```bash
cd contracts
```

2. 部署合约：
```bash
npx hardhat run scripts/deploy.ts --network localhost
```

3. 部署成功后，您会看到输出：
```
开始部署合约...
部署者地址: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
部署者余额: 10000.0 ETH

部署 NotaryNFT 合约...
NotaryNFT deployed to: 0x5FbDB2315678afecb367f032d93F642f64180aa3

部署 EasyBet 合约...
EasyBet deployed to: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512

=== 合约部署完成 ===
NotaryNFT 合约地址: 0x5FbDB2315678afecb367f032d93F642f64180aa3
EasyBet 合约地址: 0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512

为部署者 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 铸造NotaryNFT...
✅ NotaryNFT 铸造成功! TokenId: 1
```

4. **记录合约地址**，稍后配置前端时需要使用

## 🌐 第三步：配置MetaMask

### 3.1 添加本地网络
1. 打开MetaMask
2. 点击网络下拉菜单
3. 选择"添加网络"
4. 填入以下信息：
   - **网络名称**: Localhost 8545
   - **新RPC URL**: http://127.0.0.1:8545
   - **链ID**: 31337
   - **货币符号**: ETH
   - **区块浏览器URL**: (留空)

### 3.2 导入测试账户
1. 点击MetaMask右上角头像
2. 选择"导入账户"
3. 输入部署者账户的私钥（从第一步记录的）
4. 确认导入

**验证**：账户应显示约10000 ETH余额

## 💻 第四步：启动前端应用

1. 打开新终端，进入前端目录：
```bash
cd frontend
```

2. 启动开发服务器：
```bash
npm start
```

3. 浏览器会自动打开 http://localhost:3000

## 🔐 第五步：连接钱包并验证身份

### 5.1 连接MetaMask
1. 在网页上点击"连接钱包"按钮
2. 选择MetaMask
3. 确认连接请求
4. 确保选择了正确的网络（Localhost 8545）

### 5.2 检查初始状态
连接后，您应该看到：
- 钱包地址显示
- 用户角色可能显示为"普通玩家"（因为NFT未激活）
- 没有"公证管理"菜单

## ⚡ 第六步：验证公证人身份

由于我们已经修改合约让NFT默认激活，连接钱包后应该直接看到公证人身份：

### 预期结果：
1. **用户角色**：显示为"公证人"
2. **导航菜单**：出现"公证管理"选项
3. **权限验证**：可以访问公证人专属功能

### 如果仍显示"普通玩家"：
检查以下条件：
- 账户ETH余额是否≥0.1 ETH（应该有约10000 ETH）
- 合约地址配置是否正确
- 网络连接是否正确（Localhost 8545）
- 是否使用了部署者账户（拥有NFT的账户）

### 快速验证方法：
在浏览器控制台输入以下代码检查NFT状态：
```javascript
// 检查当前账户是否拥有NFT
console.log("当前账户:", window.ethereum.selectedAddress);
```

**注意**：现在不需要手动激活NFT了！合约已经设置为默认激活状态。

## 🎯 第七步：测试公证人功能

### 7.1 访问公证管理
1. 点击导航栏"公证管理"
2. 应该看到公证人专属界面

### 7.2 创建竞猜项目
1. 点击"创建项目"按钮
2. 填写项目信息：
   - **项目标题**：例如"2024年世界杯冠军预测"
   - **项目描述**：详细说明
   - **分类**：选择合适分类
   - **结束时间**：设置截止时间
   - **彩票价格**：例如0.1 ETH
   - **最大彩票数**：例如1000张
   - **奖池金额**：公证人提供的初始奖金

3. 添加竞猜选项：
   - 至少添加2个选项
   - 例如：巴西、阿根廷、法国、德国

4. 提交创建

### 7.3 管理项目
1. 查看已创建的项目列表
2. 测试项目状态管理
3. 测试结果发布功能

## 🧪 第八步：测试普通用户视角

### 8.1 切换到普通用户账户
1. 在MetaMask中导入另一个测试账户
2. 或创建新账户
3. 确保该账户没有NotaryNFT

### 8.2 验证权限限制
连接普通用户账户后：
- 用户角色应显示"普通玩家"
- 没有"公证管理"菜单
- 只能参与竞猜，不能创建项目

## 🔍 第九步：功能验证清单

### ✅ 公证人身份验证
- [ ] NFT拥有者识别正确
- [ ] ETH余额检查生效
- [ ] NFT激活状态验证
- [ ] 角色显示正确

### ✅ 公证人权限
- [ ] 可以访问"公证管理"
- [ ] 可以创建竞猜项目
- [ ] 可以管理自己的项目
- [ ] 可以发布项目结果

### ✅ 普通用户限制
- [ ] 无法访问公证管理
- [ ] 无法创建项目
- [ ] 只能参与竞猜

## 🐛 常见问题排查

### 问题1：连接钱包后仍显示"普通玩家"
**解决方案**：
1. 检查NFT是否已激活
2. 确认ETH余额≥0.1
3. 验证合约地址配置
4. 刷新页面重新检测

### 问题2：无法激活NFT
**解决方案**：
1. 确认使用正确的账户（NFT拥有者）
2. 检查合约地址是否正确
3. 确认网络连接正常
4. 查看控制台错误信息

### 问题3：交易失败
**解决方案**：
1. 检查Gas费用设置
2. 确认账户余额充足
3. 验证合约函数调用参数
4. 重新尝试交易

### 问题4：前端显示异常
**解决方案**：
1. 检查.env文件配置
2. 确认合约地址正确
3. 重启前端服务
4. 清除浏览器缓存

## 📝 测试记录模板

建议记录测试过程：

```
测试日期：____
测试环境：本地开发环境

1. 合约部署
   - NotaryNFT地址：____
   - EasyBet地址：____
   - 部署者账户：____

2. 身份验证测试
   - NFT激活：[ ] 成功 [ ] 失败
   - 角色识别：[ ] 公证人 [ ] 普通玩家
   - 权限验证：[ ] 通过 [ ] 失败

3. 功能测试
   - 创建项目：[ ] 成功 [ ] 失败
   - 项目管理：[ ] 成功 [ ] 失败
   - 权限控制：[ ] 正常 [ ] 异常

4. 问题记录
   - 问题描述：____
   - 解决方案：____
```

## 🎉 测试完成

完成所有测试步骤后，您应该能够：
1. 成功部署NotaryNFT合约
2. 验证公证人身份
3. 使用公证人功能创建和管理竞猜项目
4. 理解权限控制机制

恭喜您完成NotaryNFT公证人功能测试！

---

**注意**：这是开发测试环境，生产环境需要：
1. 部署到真实网络（如以太坊主网或测试网）
2. 配置真实的合约地址
3. 实现完整的安全验证
4. 添加更多错误处理和用户提示